#!/bin/bash

if [ -n "$(git status --porcelain)" ]; then
    echo "There are uncommitted modifications - not making a package!"
    exit 1
fi

DESCRIBE=$(git describe)
BRANCH=$(git rev-parse --abbrev-ref HEAD)

rm -rf node_modules
npm install
npm install
gulp release

mkdir -p target
tar czf target/aremi-natmap-${BRANCH}-${DESCRIBE}.tar.gz \
  node_modules \
  wwwroot \
  run_server.sh \
  server.js \
  proxyAuth.json
